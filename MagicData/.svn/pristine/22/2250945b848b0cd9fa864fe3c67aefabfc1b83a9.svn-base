$(function() {
	/*
	 * @author lifusheng
	 */
	                   var click=0;
//点击高级查询触发的事件
$("#advancedsearch").click(function() {
	                  click=click+1;
						var queryableMap = pageVariate.queryableMap;
						var aliasAll =pageVariate.aliasAll;
						var m = "";
						if(click==1){
						    	for ( var key in queryableMap) {
									// 动态增加下拉框
									     if(key=="Person"){
										     $("#queryable").append("<option value='" + key + "' selected='selected'>" + key+ "</option>");
											 for (var i = 0; i < queryableMap.Person.length; i++) {
												var personquerable = queryableMap.Person[i];
												var personalias = aliasAll.Person[personquerable];
												m += " <li class='gjsearchLi'>";
												m += "<span>" + personalias+ "</span>";
												var realid = "Person"+ i;
												m += "<input type='text'  id='"+ realid + "'  />";
												m += "</li>";
											                                                      }
										        $("#point").html(m);
									                    }
										if(key!="Person"){
										      $("#queryable").append("<option value='" + key + "'>" + key+ "</option>");
										                  }
									                               }
						             }
						$("#queryable").bind("change",function() {
											m = "";
											var selectvalue = $("#queryable  option:selected").text();
											// 页面添加
											for (var i = 0; i < queryableMap[selectvalue].length; i++) {
												var querable = queryableMap[selectvalue][i];
												var alias = aliasAll[selectvalue][querable];
												if (querable == "arrivedate"| querable == "departuredate") {
													m += " <li class='gjsearchLi'>";
													m += "<span>" + alias+ "</span>";
													var realid = selectvalue+ i;
													m += "<input type='text'  id='"+ realid + "'  />";
													m += "</li>";
												}
												else {
													m += " <li class='gjsearchLi'>";
													m += "<span>" + alias+ "</span>";
													var realid = selectvalue+ i;
													m += "<input type='text'  id='"+ realid + "'  />";
													m += "</li>";
												}

											}
											$("#point").html(m);
										                         })
						 $("#advancesearch").show();
					                      });
 //点击查询触发的事件      
 $("#query").click(function() {
	                        var queryableMap = pageVariate.queryableMap;
		                    var aliasAll =pageVariate.aliasAll;
		                    var selectvalue = $("#queryable  option:selected").text();
              	             //构建查询的json字符串                                      
		                    var json = "{";
		                    json += "\"";
		                    json += selectvalue;
		                    json += "\"";
		                    json += ":{";
		                   for (var i = 0; i < queryableMap[selectvalue].length; i++) {
			                      var id = selectvalue + i;
			                      var m = $("#" + id).val();
  			                          m=trim(m);
			                      if(m!=""){
			                          json += "\"";
								  json += queryableMap[selectvalue][i];
								  json += "\"";
								  json += ":";
								  json += "\"";
								  json += m;
								  json += "\"" + ",";
											          }
			                     if (i == queryableMap[selectvalue].length - 1) {
				                     json = json.substring(0, json.length - 1);
				                     json += "}}";
			                                                                     }
			                     				                                        }
		                
                          //当用户什么都不输入的时候控制不让用户提交
		                    var sum = 0;
		                    $("input[type=text]").each(function(i){
		                            var text = $(this).val();
		                            if(text!=""){
		                                  sum += 1;
		                                         }
		                                                          });
		                    if(sum==0){
		                    alert("请输入查询条件");
		                               }
		              		//向后台传递json数据进行查询
	                       if(sum!=0){
	                    	   $.ajax({  
		               				type : "post",  
		               			    url : pageVariate.base + "query/findObjByMoreProperty.action", 
		               	 	        data:{"searchJson":json},
		               				dataType: "json",
		               				success : function(data){
		               					maskManager.hide();
		               					pageVariate.tempData = eval(data);
		               		        	var nodeSize = pageVariate.tempData.nodes.length;
		               		            if(nodeSize == 1){
		               		            	searchManager.searchLinkage(pageVariate.tempData);
		               		            	$(".easyui-tabs").tabs('select', 0);
		               		            }else if(nodeSize > 1){
		               		            	searchManager.moreNodeHandle(pageVariate.tempData);
		               		            	$(".easyui-tabs").tabs('select', 0);
		               		            }else{
		               		             	hintManager.showHint("未查询到数据。");
		               		            }
		               				},
		               		        error:function(){
		               		         	maskManager.hide();
		               		        	hintManager.showHint("未查询到数据。");
		               		        }
		               			});
	                       }   
	                       
	                       //弹出查询结果展示页面
	                       if(sum!=0){  
	                       searchshow("");
	                       }
		});
	//清空
$("#clear").click(function() {
	$("input").val("");
	                          });
	
                                          })
//删除左右两端的空格
function trim(str){ 
　　     return str.replace(/(^\s*)|(\s*$)/g, "");
　　 }

//function searchshow(str){
////	var connect = "";
////	connect+= "<tr>"; 
////	connect+= "<th  >  服务器名称 </th>";
////	connect+= "<th >  服务器IP </th>";							            
////	connect+= "<th >搜索</th>";							             
////	connect+= "<th >BBS论坛 </th>"
////	
////	connect+= "</tr>";
////	$("#tablehead").html(connect);
////   $("#tableshow").show();
//}