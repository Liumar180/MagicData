<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ include file="/WEB-INF/jsp/common/common.jsp" %>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <base href="<%=basePath%>">
    
    <title>系统配置</title>
    
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
	<link rel="stylesheet" type="text/css" href="styles/lawcase/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="styles/systemManage/css/reset.css"/>
	<style type="text/css">
		.abc {
		    color: #ffb517;
		    width: 78%;
		}
		tr .tdWidth {
			width: 24%;
		}
		.systemDiv {
    		border: 2px solid #1b31b6;
    		/* height: 100%; */
    		padding: 0 10px 10px;
		}
		#tableid{
			width:100%;
			margin:10px auto 0px auto;
		}
		#tableid .titleTr{
			width:100%;
			height:40px;
			line-height:40px;
			background:#264494;
			color:#30fffd;
		}
		#tableid .firstTd{
			padding-left:40px;
		}
		#tableid select{
			height:32px;
			lien-height:32px;
			background: #091c43;
    		border: 1px solid #2548a6;
    		padding-left:5px;
		}
.a-upload {
    padding: 4px 10px;
    line-height: 20px;
    position: relative;
    cursor: pointer;
    color: #fff;
    background: #1c3f8e;
    border: 1px solid #3b66dd;
    border-radius: 4px;
    overflow: hidden;
    display: inline-block;
    *display: inline;
    *zoom: 1;
    font-size:14px;
    float: left;
}

.a-upload  input {
    position: absolute;
    /* font-size: 100px; */
    right: 0;
    top: 0;
    opacity: 0;
    filter: alpha(opacity=0);
    cursor: pointer
}

.a-upload:hover {
    color: #fff;
    background: #1c3f8e;
    border-color: #3b66dd;
    text-decoration: none
}
.showFileName{
	/* width: 20%; */
	height: 30px;
	line-height: 30px;
	display: inline-block;
	float: left;
	margin-left: 20px;
	border: none;
	background: none;
}

	</style>
  </head>
  
  <body>
  	<div class="systemDiv">
		<table id="tableid" class="list-unstyled clearfix">
			<tr class="titleTr">
				<td class="firstTd">节点类型</td>
				<td>第一默认值</td>
				<td>第二默认值</td>
				<td>图片预览</td>
				<td>图标修改</td>
			</tr>
		</table>
	  	<div class="resetbtnDiv">
	    	<input type="button" class="resetBtn"  onclick="save()" value="保存">
	    </div>
    </div>
    <script type="text/javascript" src="scripts/jquery.min.js"></script>
    <script type="text/javascript" src="styles/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="styles/bootstrap/js/bootstrap-prompts-alert.js"></script>
	<script type="text/javascript" src="scripts/ajaxfilesupload.js"></script>
    <script type="text/javascript">
    	var datas ;
    	$(function(){
    		$.ajax({
    			type:"post",
    			url:"dataManage/getTitanStructure.action",
    			success:function(data){
    				datas = data;
    				var vertexs = data[0];
    				var vertexsView = data[2];
    				var html = "";
    				for(var lable in vertexs){
						html += "<tr>";
    					html += "<td style='width:18%;padding-left:40px;'>"+lable+"</td>";
    					var propertyArr = vertexs[lable];
    					var viewArr = vertexsView[lable];
    					var first = viewArr[0];//第一个默认显示值
    					var	second = viewArr[1];//第二个默认值
    					if(propertyArr){
    						html += "<td class='tdWidth'><select class='abc' name='"+lable+"-0'>";
    						var tempHtml = "";
//     						var fileHtml = "";
	    					for(var i=0;i<propertyArr.length;i++){
	    						var property = propertyArr[i].name;
	    						if(first && first == property){
	    							html += "<option value='"+property+"' selected='selected'>"+property+"</option>";
	    						}else{
	    							html += "<option value='"+property+"'>"+property+"</option>";  
	    						}
	    						if(second && second == property){
	    							tempHtml += "<option value='"+property+"' selected='selected'>"+property+"</option>";
	    						}else{
	    							tempHtml += "<option value='"+property+"'>"+property+"</option>";  
	    						}
// 	    						fileHtml += ;
	    					}
	    					html += "</select></td>";
	    					
	    					html += "<td class='tdWidth'><select class='abc' name='"+lable+"-1'>";
	    					html += tempHtml;
	    					html += "</select></td>";
	    					html += "<td style='height:60px;width:70px;'><img src='images/img/"+lable+".png'  style='height:50px;width:50px;'/></td>";
	    					html += "<td class='tdWidth'><a href='javascript:void(0);' class='a-upload'><input type='file' id='"+lable+"' name='file' class='a-input' />点击这里上传文件</a><input type='text' disabled='disable' class='showFileName' value='' id='fileName'></td>";
    					}
    					html += "</tr>";
    				}
    				$("#tableid").append(html);
    			}
    		});
    		//5月3日增加
    		$(".a-input").live("change",function(){
    			var fileVal = $(this).val();
           		$(this).parent().next().val(fileVal);
    		})
    	})
    	function save(){
    		var fileIds  = [];
    		var fileIdsImg = [];
    		var flag = false;
    		$("input[type='file']").each(function(){
    			var id = $(this).attr("id");
				var value = $(this).val();
				if(value){
					var img = value.substring(value.lastIndexOf("\\")+1, value.length);
					
					/* if(id+".png" == img){
						fileIds.push(id);
					}else{
						parent.hintManager.showHint("图片名称必须为节点类型，图片格式为.png。请重新上传！");
						flag = true;
						return false;
					} */
					fileIds.push(id);
					fileIdsImg.push(id);
				}
				
	        });
    		if(flag) return;
    		confirm("是否要重新设置默认显示值？",function(){
				var vertexsView = datas[2];
	    		$("select").each(function(){
	    			var name = $(this).attr("name");
					var value = $(this).val();
					var nameArr = name.split("-");
					vertexsView[nameArr[0]][nameArr[1]] = value;
					
		        });
	    		$.ajaxFileUpload({
			         type:"post",
			         url:"titanStruManage/uploadImgs.action",
			         dataType:"json",
			         data:{"datas" : JSON.stringify(datas).replace(new RegExp("\"","g"),"'"),"fileIdsImg":fileIdsImg},
			         fileElementId : fileIds, 
			         success:function(data){
			        	 var result = data.result;
			        	 if(result){
						 	parent.hintManager.showInfoHint("保存设置成功。");
			        	 }else{
			        		parent.hintManager.showHint("保存设置失败，请联系管理员！");
			        	 }
			         },
			         error:function(){
			         	parent.hintManager.showHint("保存设置异常，请联系管理员！");
			         }
			     });
			});
    	}
       
    </script>
  </body>
</html>
