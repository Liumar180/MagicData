<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ include file="/WEB-INF/jsp/common/common.jsp" %>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
pageContext.setAttribute("base",basePath);
String username=(String)session.getAttribute("username");
Integer roleType=(Integer)session.getAttribute("roleType");
request.setAttribute("username",username);
request.setAttribute("roleType",roleType);
%>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>数据魔方</title>
    <base href="<%=basePath %>">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta name="renderer" content="webkit">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
	 <!-- CSS Bootstrap & Custom -->
    <link href="styles/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="styles/css/font-awesome.min.css" rel="stylesheet" type="text/css">  
    <link href="styles/flexslider.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="styles/css/templatemo_style.css" rel="stylesheet" type="text/css">
    <link href="styles/css/base.css" rel="stylesheet" type="text/css">
    <link href="styles/css/index.css" rel="stylesheet" type="text/css">
    <link href="styles/css/style.css" rel="stylesheet" type="text/css">
    <link href="styles/css/customCss.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="<%=basePath%>/styles/css/menuStyle.css" />
    <!--9月15日添加的样式  -->
    <link href="styles/css/themes/default/easyui.css" rel="stylesheet" type="text/css">
    <link href="styles/css/themes/icon.css" rel="stylesheet" type="text/css">
    <link href="styles/css/demo.css" rel="stylesheet" type="text/css">
    <link href="styles/css/tabEmail.css" rel="stylesheet" type="text/css">
    <!--9月15日添加的样式结束  -->
    <script src="scripts/modernizr.js"></script>
    <script type="text/javascript" src="<%=basePath%>/scripts/jquery.min.js"></script>
	<script type="text/javascript" src="<%=basePath%>/scripts/jquery.wheelmenu.js"></script>
   <!--9月16日添加样式-开始  -->
    <link href="styles/css/emailDialog/jquery.tagsinput.css" rel="stylesheet" type="text/css">
    <link href="styles/css/emailDialog/jquery-ui.css" rel="stylesheet" type="text/css">
    <link href="styles/css/emailDialog/tccEmail.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="scripts/laydate-v1.1/laydate/laydate.js"></script>
    <!--9月16日添加样式-结束  -->
    <style type="text/css">
		html{height:100%}
		body{height:100%;margin:0;padding:0;font-size:15px;}
		.div-relative{position:relative; height:100%; width:100%} 
		.div-a{ position:absolute; right:100px; bottom:30px;width:40px; height:130px} 
		.olControlButtonItemActive {
         position: absolute;
         cursor: pointer; 
         top: 5px;
         right: 0px;
         background-image: url("images/map/back.png");
         width: 18px;
         height: 18px;
         -moz-user-select:none;  
           }
        .olControlPanel {
        width: 25px;
        height: 25px;
        top: 5px;
        right: 0px;
          }

    </style>
  </head>
 <body onselectstart="return false">
    <div class="topNavbar clearfix" >
            <a href="#" class="navbar-brand" style='padding:18px 0px 0px 50px'><img src="images/img/DataSmart-logo.png"></a>
            <span class="dataSpan"><em>|</em>数据分析</span>       
         <div class="searchbar" >          
           <div class='property_div' >
           	 <!-- <select name="property" id="propertySel">   
		        <option value="name" selected>姓名</option>   
		        <option value="email">邮箱</option> 
		        <option value="phonenum">电话</option>   
		        <option value="idcard">身份证</option>   
		      </select> -->
		      	 <span class="select_txt" name="name">姓名</span><a class="selet_open"></a>
		         <div class="option">
		            <span class="name" onclick="document.getElementById('content').disabled='';document.getElementById('content').value='';">姓名</span>
		            <span class="email" onclick="document.getElementById('content').disabled='';document.getElementById('content').value='';">邮箱</span>
		            <span class="phonenum" onclick="document.getElementById('content').disabled='';document.getElementById('content').value='';">电话</span>
		            <span class="numid" onclick="document.getElementById('content').disabled='';document.getElementById('content').value='';">IM</span>
		            <span class="idcard" onclick="document.getElementById('content').disabled='';document.getElementById('content').value='';">身份证</span>
		            <span class="username" onclick="document.getElementById('content').disabled='';document.getElementById('content').value='';">用户名</span>
		            <span class="password" onclick="document.getElementById('content').disabled='';document.getElementById('content').value='';">密码</span>
		            <span class="emailAll" onclick="advancedSearch()">邮件查询</span>
		         </div>   
           </div>
           <div class='search_div' >
            <input class='search_input'  type='text' id='content' name='content' placeholder=' 搜索内容'/>
            <button  type="button" value='' onclick='searchContent("")'><img src="images/search/searchBtn.png"></button>
            <div class="hideDiv">
            </div>
           </div>
        </div>
         <div class="personal fr">
             <ul>
              	<li  class="topIcon5"><a href="pwdCrack/getPTList.action" class="userlistA">密码破解</a></li> 
                <c:if test="${roleType==1}">
               		<li><a href="getAllUser.action">用户列表页</a></li>
                </c:if>
             </ul>
             
       </div>
    </div>
<!-- 菜单 -->
<!--9月15日新改  -->
	<div id="tt" class="easyui-tabs" data-options="tools:'#tab-tools'">
		<div  title="首页" style="padding:10px 0px;overflow:hidden;">
			<div class="icontainer clearfix" >
			    <div id="menuDiv" style="visibility: hidden;position:absolute;z-index:2">
<!-- 			       <s:action name="getMenuData" namespace="/" executeResult="true" id="getMenuData" flush="true"></s:action> -->
			    </div>
			    <div class='left_top' >
			    	<div class="mapDiv" style='display:none;width:100%; height:100%;background: #f1efe9;'>
						<table width='100%'  border="0" cellpadding="0" cellspacing="2" height='100%'>
							<tr>
								<td  style="width:100%;height:100%;">
									<div id="map"  class="div-relative"></div>
								</td>
							</tr>
						</table>
					</div>
				   <!-- 可视化展示-->
				    <div class='zoomline' style='display:none;width:30px; height:150px;position: absolute; top:70px;left: -5px;'>
				   </div>
				   <div class='displayDiv' style='display:none;width:100%; height:100%;'>
				   </div>
				</div>
				<!-- 时间轴 -->
				<div class='left_down' > 
				 	<div class="bar_div"  id="main"></div>
				</div>
				<div class='right clearfix' >
					<div class="rightCon">
			    	<div class="tabBox clearfix">
			        	<ul class="clearfix">
			            	<li class="first"><a href="javascript:void(0)" class="setOn" title="直方图"> </a></li>
			                <li class="second"><a href="javascript:void(0)" title="浏览器"></a></li>
			                <li class="last"> <a href="javascript:void(0)" title="过滤器"></a></li>
			            </ul>       
			        </div>
			   	 	<div class="tabCon">
			        	<div class="firstCon">
			              <div class="clsHead clearfix">
			                <h3>对象类型</h3>
			                <span><img src="images/img/1.png" width="15" height="9" /></span>
			              </div>
			              <div class="clsContent clearfix">
			              	<p class="pTit"><span>所有对象</span><em id="allObj">（0）</em></p>
			                <ul>
			                <li class="clearfix"><span class="icon1 fl"></span><i id="allPerson">0</i><div class="bar fl"><div class="leftBar fl"></div><div id="personRight" class="rightBar fr"><div class="test1 fl"></div></div></div></li>
			                <li class="clearfix"><span class="icon2 fl"></span><i id="allEvent">0</i><div class="bar fl"><div class="leftBar fl"></div><div id="eventRight" class="rightBar fr"><div class="test1 fl"></div></div></div></li>
			                </ul>
			              </div>
			            </div>
			          	<div class="secondCon">
			            	<div class="clsHead1 clearfix">
			                <h3>实体属性</h3>
			                <span><img src="images/img/1.png" width="15" height="9" /></span>
			              </div>
			              <div class="histogramDiv clsContent1 clearfix">
			              </div>
			            </div>
			        </div>
			    	<div class="browserDiv tabCon hiddenCon clsContent1 ">
			    		<div class="maincon clearfix" style="display: none">
						<div class="chjBox">
			                <div class="serListBox" >
			                	<ul class="serTit clearfix">
			                		<li class="li1"><a href="javascript:void(0);" class="check">全选</a></li>
			                		<li class="li2"><a class="btnDel" href="javascript:void(0);">删除</a></li> 
			                		<li class="li3"><a href="javascript:void(0);" class="checkInvert">反选</a></li>       
			                	</ul>
			                	<div class="serList">
			        
			                    </div>
			                </div>
			            	
			            </div>
			        </div>
			    		<div class="personPage" style="dispaly:none">
			    		</div>
			    	</div>
			    	<div class="tabCon hiddenCon1">
			    		<div class="commStyle clearfix">
			    			<span>类型</span>
			    			<select class="filterType" onchange="changeProperty(this.value)">
			    				<c:forEach items="${vertexType}" var="type" >
			    					<option value="${type}">${type}</option>
			    				</c:forEach>
			    			</select>
			    		</div>
			    		<div class="commStyle clearfix">
			    			<span>属性</span>
			    			<select class="filterProperty">
			    				<c:forEach items="${vertexProperty.Person}" var="property" >
			    					<option value="${property}">${property}</option>
			    				</c:forEach>
			    			</select>
			    		</div>
			    		<div class="commStyle clearfix">
			    			<span>内容</span>
			    			<input type="text" class="inputBg filterContent" />
			    		</div>
			    		<div class="buttonDiv">
							<a href="javascript:void(0);" class="check" onclick="filterGraph('check')">过滤</a>
							<a href="javascript:void(0);" class="checkInvert" onclick="filterGraph('checkInvert')">反选</a>
			    		</div>
			    	</div>
			    </div>
				</div>	
  			</div>	
		</div>
	</div>
	<div id="tab-tools">
<!-- 		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick="addPanel()"></a> -->
		<!--<a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-remove'" onclick="removePanel()"></a>-->
	</div>
	<!--9月15日结束  -->
<!--   邮件弹出层 -->
  <div class="tccBox">
    	<div class="bg"></div>
        <div class="emailCon" style="z-index:1000;">
        	<b class="closeB"></b>
            <div class="barBox" id="barBox">
         
            </div>
        </div>
    </div>
     <!--邮件高级查询页面 --开始 -->
    	<div class="searchtccBox">
    		<div class="bg"></div>
        	<div class="gjsearchCon" style="z-index:1000;">
        		<h3>邮件高级查询管理</h3>
        		<b class="closeB" onclick="$('.searchtccBox').hide()"></b>
           		<div class="gjsearchBox">          			
           			<ul class="clearfix">
           				<li class="gjsearchLi">
           					<span>全文：</span>
           					<input type="text"  id="allTextOfSearch" />
           				</li>
           				<li class="gjsearchLi">
           					<span>主题：</span>
           					<input type="text"  id="titleOfSearch" />
           				</li>
           				<li class="gjsearchLi">
           					<span>收件人/发件人：</span>
           					<input type="text"  id="mailAddressOfSearch" />
           				</li>
           				<li class="gjsearchLi">
           					<span>邮件正文：</span>
           					<input type="text"  id="contectOfSearch" />
           				</li>
           				<li class="gjsearchLi">
           					<span>附件文件名：</span>
           					<input type="text" id="filenameOfSearch"/>
           				</li>
           				<li class="gjsearchLi">
           					<span>附件内容：</span>
           					<input type="text" id="filecontectOfSearch"/>
           				</li>
           				<li class="gjsearchLi">
           					<span>开始日期：</span>
           					<input onclick="laydate(from).skin('yahui')" placeholder="请输入日期" class="laydate-icon" id="datefromSearch" height="50px" />
           				</li>
           				<li class="gjsearchLi">
           					<span>结束日期：</span>
           					<input  onclick="laydate(to).skin('yahui')" placeholder="请输入日期" class="laydate-icon" id="datetoSearch"/>
           				</li>
           				<li class="gjsearchLi">
           					<span>热词：</span>
           					<input type="text"  id="hotwordOfSearch"/>
           				</li>
           				<li class="gjsearchLi">
           					<span>标签：</span>
           					<input type="text" id="tagOfSearch"/>
           				</li>
           				<li class="lastli">
           					<span class="lastliSpan">文件夹：</span>
           					<!--<input type="text" id="folderOfSearch"/>  -->
           					<div class="catalogDiv">
           						<ul id="treeDemo" class="ztree"></ul>
           					</div>
           				</li>
           			</ul>
				         
           			<div class="gjsearchbtnBox">
           				<a href="javascript:void(0)" onclick="submitAdvanceSearch()" class="qdBtn">查询</a>
           				<a href="javascript:void(0)" onclick="$('.searchtccBox').hide()"  class="qxBtn">取消</a>
           			</div>
           		</div>
           	</div>
    	</div>
    <!--邮件高级查询页面 --结束 -->
  <div class='hintMsg'></div>
   <!--1月14日加首页右侧历史记录弹出层-->
	<div class="historytccBox">
		<div class="bg"></div>
		<div class="historyBox">
			<div class="historyConBox">
				<h3>添加案件</h3>
				<b></b>
				<iframe src=""  id="pop_iframe" name="fc" frameborder="0" width="100%" height="95%"></iframe>						
			</div>
		</div>
	</div>
      
  <!-- JavaScripts -->
  <!--9月15日添加的js  -->
	<script type="text/javascript" src="scripts/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="scripts/tabEmail.js"></script>
    <!--9月15日添加的js  -->
  <script type="text/javascript" src='scripts/d3.v3.js' ></script> 
  <script type="text/javascript" src='scripts/d3-tip.js' ></script>
  <script type="text/javascript" src="scripts/customJs.js"></script>
  <script type="text/javascript" src="scripts/jquery.wheelmenu.js"></script>
    <!--11月11日添加的js--开始  -->
  <script type="text/javascript" src="scripts/index/qq.js"></script>
  <!--11月11日添加的js--结束  -->
  <script type="text/javascript" src="scripts/graph_tabsHandler.js"></script>
  <script src="styles/bootstrap/js/bootstrap.min.js"></script>
  <script src="styles/bootstrap/js/bootstrap-prompts-alert.js"></script>
  <script src="scripts/jquery.singlePageNav.js"></script>
<!--   <script src="scripts/templatemo_custom.js"></script> -->
  <script defer src="scripts/jquery.flexslider.js"></script>
  <script type="text/javascript" src="scripts/echarts.js"></script>
  <script type="text/javascript" src="scripts/tab.js"></script> 
  <script type="text/javascript" src="scripts/bar_echartsBar.js"></script> 
  <script type="text/javascript" src="scripts/OpenLayers.js"></script> 
  <!-- /*点击邮件出现的弹出层*/ -->
  <!--9月16日添加的js--开始  -->
  <script type="text/javascript" src="scripts/emailDialog/jquery.tagsinput.js"></script>
  <script type="text/javascript" src="scripts/emailDialog/jquery-ui.min.js"></script>
  <script type="text/javascript" src="scripts/emailDialog/szzlCommPlug.js"></script>
  <script type="text/javascript" src="scripts/emailDialog/easing.js"></script>
  <script type="text/javascript" src="scripts/emailDialog/imgScroll.js"></script>
  <!--9月16日添加的js--结束  -->
  <script type="text/javascript" src="scripts/email.js"></script>
	<script type="text/javascript" src="scripts/emailDialog/easing.js"></script>
  <script type="text/javascript" src="scripts/emailDialog/imgScroll.js"></script>
  <!--9月21日添加的js--开始  -->
  <script type="text/javascript" src="scripts/index/advanceSearch.js"></script>
  <script type="text/javascript" src="scripts/index/search.js"></script>
  <script type="text/javascript" src="styles/zTree/js/jquery.ztree.core-3.5.js"></script>
  <script type="text/javascript" src="styles/zTree/js/jquery.ztree.excheck-3.5.js"></script>
  <link href="styles/zTree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet" type="text/css">
  <!--9月21日添加的js--结束  -->
<!--16年1月14日添加历史记录js-->
<script type="text/javascript" src="scripts/history.js"></script> 
  <script type="text/javascript">
  var qqgroupcount=0;
//    $(function(){
// 	   $('#tt').tabs('add',{
// 			title: 'QQ',
// 			closable: true,
// 			content: "<div class='zoomQQline0' style='width:10px;z-index:999; height:10px;position: absolute; top:100px;left: 15px margin-top:-120px;  float:left;border:0px solid #F00'></div><div class='displayQQDiv0' style='width:100%; height:100%;'><div>"
			
// 		});
// 	   getQQgroup("","",0);}
//    );
  $(function(){
	   $.ajax({
          type:"post",
          url:pageVariate.base+"/query/getTreeJson.action",
          async:false,
          success:function(data){
	        	pageVariate.tempData = eval(data);
       	   zNodes=pageVariate.tempData;
          }
       });
  }); 
     /*#################操作时间轴操作相关函#########################*/
             /*点击菜单时间轴联动*/
            // $(".tccBox").show();
    function showTimeLline(id,types){
    	    isYearType=true;
        if(id){
	    	 var options = myChart.getOption(); 
	    	 myChart.clear();
	    	 var startime=pageVariate.startTimeStr;
	    	 var endtime=pageVariate.endTimeStr;
	    	 //alert(startm+"------------"+endtm);
	         $.ajax({  
	          type : "post",  
	          async : false, //同步执行  
	          url : pageVariate.base+"bar/queryYearsById.action", 
	          data : {"id":id,"types":types.toString(),"startm":startime,"endtm":endtime},  
	          dataType : "json", //返回数据形式为json  
	          success : function(result) {          	
	              if (result) { 
	            	  timeLineVariate.yearTimeCha=result.dateYear;
	             	  options.title.text = result.title; 
	                  options.legend.data = result.legend;                                      
	                  options.xAxis[0].data = result.xcategory; 
	                  options.series=result.series;
	               myChart.hideLoading();  
	               myChart.setOption(options);
	               if(timeLineVariate.firstTimeFormat){
	            	   	 timeLineVariate.firstTimeFormat = false;
		                 var sd=myChart.component.xAxis.option.xAxis[0].data;
			  			 var frimt=sd[0];  
			  	       	 var endmt=sd[sd.length-1];
			  	       	 if(frimt.length<8 &&endmt.length<8 && frimt<endmt&&frimt.length>5 &&endmt.length>5){
			  	          	timeLineVariate.stratYearTime=frimt;
			  	            timeLineVariate.endYearTime=endmt; 
			  	        	getLastDaytoLong(frimt,endmt); 
		  	       	      }
	               }
		  	       	 
		  	       	if(startime.length>14){ isYearType=false;} 
		  	       	 
	               }  
	           },  
	          error : function(errorMsg) {  
	        	  hintManager.showHint("服务器繁忙，请稍后重试！");
	              myChart.hideLoading();  
	             }  
	        });
      }
   } 
     
    //时间轴缓存变量
    var timeLineVariate = {
    	stratYearTime:"",//还原年起始时间
    	endYearTime:"",//还原年结束年时间
    	yearTimeCha:"",//时间差值（时间范围值）
    	dayStartTime:"",//查询具体天的时间
    	dayStartTimeMonth:"",//还原月起始时间
    	dayEndTimeMonth:"",//还原月结束年时间
    	firstTimeFormat:true
    };
  
    </script>

  <script type="text/javascript">
  /*加载菜单 by hx*/
    function menuClick(menuParam){
      if(null!=menuParam&&menuParam!=""){
        hideAll("wheel");
        $("#menuDiv").css("visibility","hidden");
        menuClickLindage(menuParam);
      }
    }
    $(function(){
//        $("body").mousedown(function(event, a){//dblclick
//           /* if(event.which == 3 || a == 'right'){
//            showMenu(event);
//           } */
//            showMenu(event);
//        });

	   /* 修改菜单页面的加载方式 */
	   $.ajax({
              type:"post",
              url:"${base}getMenuData.action",
              async:false,
              success:function(data){
                $("#menuDiv").html(data);
              }
           });
	   
       $(".wheel-button").wheelmenu({
    	    trigger: "click",
    	    animationSpeed:"fast",
    	    liSize:rootnumber,
    	    angle:[0,360]
    	},rootWheelR);
       
     });
    
    function showMenu(event){
        if($("#menuDiv").css("visibility")=="visible"){
            $(this).bind('contextmenu',function(e){  
             return false;  
            });
            hideAll("wheel");
            /* $("#menuDiv").load("#getMenuData"); */
            $("#menuDiv").css("visibility","hidden");
        }else{
            $(this).bind('contextmenu',function(e){  
             return false;  
            });
            var showFlag = "";
            $.ajax({
	              type:"post",
	              url:"${base}getMenuShowFlag.action",
	              async:false,
	              success:function(data){
// 	                showFlag = data.showMenuFlag;
	                showFlag = data;
	              }
	           });
	           if("T" == showFlag){
	              var x = event.pageX-280-20-20;
               var y = event.pageY-180+70-40;
               clearClickIco("wheel");
               $("#menuDiv").css("margin-left",x);
               $("#menuDiv").css("margin-top",y);
               $("#menuDiv").css("visibility","visible");
               
               $(".wheel-button").trigger("click"); 
	           }
        }
     }  
       
    /******************************查询入口 start**************************************/   
      /*发送mail*/
	function sendmails(id){
		var str=document.getElementsByName("mailcheckbox"+id);
		var objarray=str.length;
		var oblist=new Array();
		var oblistcount=0;
		var result=new Array();
		for (var i=0;i<objarray;i++){
		  if(str[i].checked == true){
			oblist[oblistcount]=str[i].value;
			++oblistcount;
		  }
		}
		for (var i=0;i<oblist.length;i++){
				result[i]=emailmap.get(oblist[i]).vertexID;
		}
		if(oblistcount == 0){
			 hintManager.showHint("请至少选择一个mail！");
		}else{
			//跳到首页 TODO
			// .....
			graphManager.sendmailToGraph(result);
			$(".easyui-tabs").tabs('select', 0);
			
			
		}
	}
    //页面缓存变量
    var pageVariate = {
   		root:"",//查询对象
   		personId:"",//查询对象ID
   		uuid:"",//查询对象唯一标示
   		types:[],//事件类型
   		eventFlag:false,//当前显示状态
   		startTime:"",//查询开始时间
   		endTime:"",//查询结束时间
   		startTimeStr:"",//时间轴所需
   		endTimeStr:"",//时间轴所需
   		fristFlag:true,
   	    selNode:[],//选中节点
   	 	tempDeleteId:[],//删除id
   	    tempData:"",
   	 	openMap:new Map(),//展开缓存
   	 	currentSelFlag:false,
   	 	typeMap:new Map(),//查询type缓存
   	 	selectAllFlag:true,//列表全选标记
   		base:"${base}"
    }
	
  	$(function(){
  		searchManager.emptyIdCache();
		//回车查询
		$('#content').on('keypress',function(event){
	           if(event.keyCode == "13"){
	        	   searchContent("");
	           }
	       });
	});
    var pageNO=0;
    /*查询入口*/
  	function searchContent(more){
  		var content = $('#content').val();
  		var propertySel = $(".select_txt").attr("name");
  		if(more==""){pageNO=0;}else{
  			content = $('#'+more+'tabvalue').val();
  			pageNO=pagemap.get(more)+1;
  		}
  		if("emailAll" == propertySel){
  			$.ajax({
		         type:"post",
		         url:"${base}query/getEmailsFullText.action",
		         data:{
	  				 property:propertySel,
		        	 content:content,
		        	 allText:advanceSearch.get("allTextOfSearch"),
		        	 titleOfSearch:advanceSearch.get("titleOfSearch"), 
		        	 mailAddressOfSearch:advanceSearch.get("mailAddressOfSearch"), 
		        	 contectOfSearch:advanceSearch.get("contectOfSearch"), 
		        	 filenameOfSearch:advanceSearch.get("filenameOfSearch"), 
		        	 filecontectOfSearch:advanceSearch.get("filecontectOfSearch"), 
		        	 hotwordOfSearch:advanceSearch.get("hotwordOfSearch"), 
		        	 tagOfSearch:advanceSearch.get("tagOfSearch"), 
		        	 folderOfSearch: advanceSearch.get("folderOfSearch"), 
		        	 datefromSearch:advanceSearch.get("datefromSearch"), 
		        	 datetoSearch:advanceSearch.get("datetoSearch"), 
		        	 pageNo:pageNO,
		        	 pageSize:5,
		        	 date:new Date().getTime() 
		         },
		         dataType:"json",
		         success:function(data){
		        	 //++pageNO;
		        	var emails = eval(data);
		        	
		        	if(emails && emails.length>0){
		        		// TODO
		        		if(more==""){getmaillist(emails,"");}else{pagemap.put(more,pageNO);getmaillist(emails,more);}
		        	}else{
		        		hintManager.showHint("未查询到邮件数据。");
		        	}
		           },
		         error:function(){
		        	 hintManager.showHint("未查询到邮件数据。");
		         }
		     });
  		}else{
	  		$.ajax({
		         type:"post",
		         url:"${base}query/getObj.action",
		         data:{
	  				 property:propertySel,
		        	 content:content,
		        	 date:new Date().getTime() 
		         },
		         dataType:"json",
		         success:function(data){
	//	            pageVariate.root = $.parseJSON(data);
		        	pageVariate.tempData = eval(data);
		        	var nodeSize = pageVariate.tempData.nodes.length;
		            if(nodeSize == 1){
		            	searchManager.searchLinkage(pageVariate.tempData);
		            	$(".easyui-tabs").tabs('select', 0);
		            }else if(nodeSize > 1){
		            	searchManager.moreNodeHandle(pageVariate.tempData);
		            	$(".easyui-tabs").tabs('select', 0);
		            }else{
		             	hintManager.showHint("未查询到数据。");
		            }
		           },
		         error:function(){
		        	 hintManager.showHint("未查询到数据。");
		         }
		     });
  		}
  	}
  	var emailmap = new Map();
  	var pagemap=new Map();
  	/******************************查询入口  end**************************************/ 
  
  	/******************************整合菜单、时间轴 、地图 start**************************************/
  	/* 菜单点击
  	 * 此处配置按钮执行的方法
     * 1search=查询,2connect=关联,3openList=展开,4clear=清空,5delete=删除,6map=地图
     * 11object=对象,13net=网络
     * 831all=所有(3级),832bbs=帖子,833doctor=医疗,834talk=通话,835login=网站登录,836mail=邮件
    */
  	function menuClickLindage(menuParam){
  		var re=/^83\d{1}.*/;
  		if(re.test(menuParam)){//事件查询
  			var searchflag = true;
  			if("831all" == menuParam){
  				searchflag = changeState("event_all");
  	  		}else if("832bbs" == menuParam){
  	  			searchflag = changeState("event_bbs");
  	  		}else if("833doctor" == menuParam){
  	  			searchflag = changeState("event_doctor");
  	  		}else if("834talk" == menuParam){
  	  			searchflag = changeState("event_CallEvent");
  	  		}else if("835login" == menuParam){
  	  			searchflag = changeState("event_LoginEvent");
  	  		}else if("836mail" == menuParam){
  	  			searchflag = changeState("event_EmailEvent");
  	  		}else if("837hotel" == menuParam){
  	  			searchflag = changeState("event_StayEvent");
  	  		}
  			if(searchflag){
	  			//删除事件相关节点
				deteleEventNode(pageVariate.uuid);
	  			graphManager.showEvent(pageVariate.types,pageVariate.startTime,pageVariate.endTime);//展示事件
	  			showTimeLline(pageVariate.personId,pageVariate.types);//时间轴联动
  			}
  		}else{
  			changeState(menuParam);
  			if("2connect" == menuParam){
  				graphManager.showConnect();
  	  		}else if("2process" == menuParam){
  	  			collapseNode(pageVariate.uuid);//删除子节点
  	  		}else if("3openList" == menuParam){
  	  			graphManager.showDetail();
  	  		}else if("4clear" == menuParam){
  	  			//清空
  	  			confirm("是否确认清空？",function(){emptyNode()});
  	  		}else if("5delete" == menuParam){
//   	  			deteleNode(pageVariate.uuid);//删除当前节点及边
				confirm("是否确认删除？",function(){deteleSelNode(pageVariate.selNode)});//修改为删除选中节点
  	  		}else if("6map" == menuParam){
	  			var eventType = ["LoginEvent"]
	  			showTimeLline(pageVariate.personId,eventType);//统计地图相关事件
  	  			showMap(pageVariate.personId,pageVariate.startTime,pageVariate.endTime);
  	  		}else if("7group" == menuParam){
  	  			
  	  		}else if("1search" == menuParam){
  	  			
  	  		}else if("10all" == menuParam){
  	  			
  	  		}else if("11object" == menuParam){
  	  			graphManager.showGroupRelative();
  	  		}else if("12event" == menuParam){
  	  			
  	  		}else if("13net" == menuParam){
  	  			graphManager.showRelative();
  	  		}
  		}
  		
  		//还原按钮状态
  		if("5delete" != menuParam && "4select" != menuParam){
  			resetCurrentNode();
  		}
  	}
  	
  	
	/*记录菜单状态
	 *id为菜单的ID，查询事件的菜单ID格式为event_type,全部为event_all
	 */
  	function changeState(id){
  		var markArr = id.split("_");
  		if(markArr.length == 2 && markArr[0] == "event"){
  			pageVariate.eventFlag="event";
  			var type = markArr[1]; 
  			if("all" == type){
  				pageVariate.types=[];
  			}else{
  				var typeArr = pageVariate.typeMap.get(pageVariate.personId);
  				if (typeArr) {
  					var index = typeArr.indexOf(type);
  					if(index>-1){
  						return false;
//   					typeArr.splice(index, 1);
  					}else{
  						typeArr.push(type);
  					}
  				}else{
  					typeArr = [];
  					typeArr.push(type);
  					pageVariate.typeMap.put(pageVariate.personId,typeArr);
  				}
  				pageVariate.types = typeArr;
  			}
  		}else if("6map" == id){
  			pageVariate.eventFlag="map";
  		}else{
  			pageVariate.eventFlag="event";//暂定
  		}
  		return true;
  	}
	
	
  	/*拖动时间轴图联动*/
  	var timeLineDragFlag = true;
  	function graphLinkage(start,end){
	  	if(start && end){
  			if(timeLineDragFlag){
	  			timeLineDragFlag = false;
				pageVariate.startTime=start;
				pageVariate.endTime=end;
		  		if(pageVariate.eventFlag == "event"){
					deteleEventNode(pageVariate.uuid);//删除事件相关节点
		  			graphManager.showEvent(pageVariate.types,pageVariate.startTime,pageVariate.endTime);
		  		}else if(pageVariate.eventFlag == "map"){
		  			showMap(pageVariate.personId,pageVariate.startTime,pageVariate.endTime);
		  		}
		  		window.setTimeout(function(){
		  			timeLineDragFlag = true;
		  		}, 600);
  			}
	  	}
  	}
  	
  	/*点击菜单或拖动时间轴map联动*/
  	function showMap(id,start,end){
  		//TODO 实现map展示
  		$.ajax({
			type : "post",
			dataType : "json",
			url : pageVariate.base+"query/getMapData.action",
			data : {
				personId : id,
				startTime : start,
				endTime : end,
				date : new Date().getTime()
			},
			dataType : "json",
			success : function(data) {
				var localtion = eval(data);
				//直方图展示
				tabsManager.histogramShow(2,localtion);
				
				//地图展示
				$('.displayDiv').hide();
				$('.zoomline').hide();
				$('.div-relative').html('');
				$('.mapDiv').show();
				init(localtion);
			},
			error : function() {
				hintManager.showHint("服务器繁忙，请稍后重试！");
			}
		});
  	}
  	
  	/* 过滤属性联动 */
    function changeProperty(type){
  	  var vertexProperty = $.parseJSON('${vertexPropertyJson}');
  	  var pros = vertexProperty[type];
  	  if(pros){
  		  var html = "";
  		  for(var i = 0;i < pros.length; i++){
     			var temp = pros[i];
     			html += "<option value='"+temp+"'>"+temp+"</option>";
  		  }
  		  $(".filterProperty").html(html);
  		  $(".filterContent").val("");
  	  }
    }
    
    /* 过滤、反选 */
    function filterGraph(flag){
  	  if(flag == "checkInvert"){
  		  tabsManager.graphHighlightInvert();
  		  return;
  	  }
  	  var type = $(".filterType").val();
  	  var property = $(".filterProperty").val();
  	  var content = $(".filterContent").val();
  	  if(content.replace(/(^\s*)|(\s*$)/g, "") == "" ){
  		  hintManager.showHint("过滤内容不能为空，请输入！");
  	  }else{
  		  if(flag == "check"){
  			  tabsManager.filterGraphHighlight(type,property,content); 
  		  }
  	  }
    }
	
  	/******************************整合菜单、时间轴 、地图 end**************************************/
  	
 	$(function(){
  			/*------头部select框--------*/
           $(".property_div").click(function(event){   
                        event.stopPropagation();
                        $(this).find(".option").toggle();
                        $(this).parent().siblings().find(".option").hide();
                        $(".hideDiv").hide();
           });
           $(document).click(function(event){
                        var eo=$(event.target);
                        if($(".property_div").is(":visible") && eo.attr("class")!="option" && !eo.parent(".option").length)
                        $('.option').hide();  
                        
                        $(".hideDiv").hide(); 
                   });
           /*赋值给文本框*/
           $(".option span").click(function(){
                        var value=$(this).text();
                        $(this).parent().siblings(".select_txt").text(value);
                        var classAttr = $(this).attr('class');
						$(".select_txt").attr("name", classAttr);
                        $("#select_value").val(value);
                       /* $(".select_txt").attr('name',)); */
           })
           
           /************************头部隐藏div************************/
	   		$(".hideDiv ul li").live("click",function(){
	   			var nodes = pageVariate.tempData.nodes;
	   			var uuid = this.id;
	   			for(var i=nodes.length-1;i>-1;i--){
	   				var node = nodes[i];
					if(uuid != node.uuid){
						nodes.remove(node);
	   				}
	   			}
	   			searchManager.searchLinkage(pageVariate.tempData);
	   			pageVariate.tempData ="";
	   			$(".hideDiv").hide(); 
	   		})
           
           /************************ 事件列表控制  ********************************/
         	//选择
			$(".serTit .li1 .check").click(function(){
				if(pageVariate.selectAllFlag==true){
					$('.serList ul li.s0 input').attr('checked',true);
					pageVariate.selectAllFlag=false;
				}else{
					$('.serList ul li.s0 input').attr('checked',false);
					pageVariate.selectAllFlag=true;
				}
			});
			
			//删除
			$('.btnDel').click(function(){
				if($('.serList ul li.s0 input:checked').length==0){
					hintManager.showHint("请选择要删除的项！");
				}else{
					confirm("是否确认删除？", function(){
						var checkID=new Array();
						$('.serList ul li.s0 input:checked').each(function(i,d){
							checkID[i]=d.id;	
						})
						listDeteleLinkage(tabsManager.list_node,checkID);
						$('.serList ul li.s0 input:checked').parents('.serUl').next('.serDetail').remove();//这个与下面的顺序不能变
						$('.serList ul li.s0 input:checked').parents('.serUl').remove();
					})
					
				}
			});
			//反选
			$('.checkInvert').click(function(){
				var len = $('.serList ul li.s0 input:checked').length;
				if(len==0){
					$('.serList ul li.s0 input').attr('checked',true);
				}else{
					$('.serList ul li.s0 input').each(function(){
						   $(this).attr("checked",!this.checked);              
				     });
				}
			});	
			
   	})
  </script>
  
  <!--<script language="javascript" src="http://app.mapabc.com/apis?t=javascriptmap&v=3&key=b0a7db0b3a30f944a21c3682064dc70ef5b738b062f6479a5eca39725798b1ee300bd8d5de3a4ae3"></script> -->
  <!-- 地图 -->  
  <script type="text/javascript">
		var options = 
				{
					projection: "EPSG:900913",
					displayProjection: "EPSG:4326",
					units: 'm'
				};
		
		var map;
		function init(data){
             map = new OpenLayers.Map("map",options);		
			/**********************加载图层 开始*******************************/

		var base = new OpenLayers.Layer.WMS("osm数据",
					//"http://192.168.20.183:8080/geoserver/test/gwc/service/wms"
					"${geoserverMapUrl}"
					, {
						'layers' : 'chinamap',
						transparent : true,
						format : 'image/png'
					}, {
						
						singleTile: true, 
						ratio: 1, 
						isBaseLayer : true

					});	
			

			map.addLayers([base]);
			map.addControl(new OpenLayers.Control.MousePosition());
			map.addControl(new OpenLayers.Control.ScaleLine());	
			
			 
		//添加图标控制层和button图标
 	    var button = new OpenLayers.Control.Button({
 			displayClass:"olControlButton", trigger: function(){
	 				$('.displayDiv').show();
	 				$('.zoomline').show();
					$('.mapDiv').hide();
					tabsManager.histogramShow(1,nodes);
					//还原地图之前的界面状态
					var typeArr = pageVariate.typeMap.get(pageVariate.personId);
	  				if (!typeArr) {
	  					typeArr = []
	  				}
	  				pageVariate.types = typeArr;
	  				pageVariate.eventFlag="event";
					showTimeLline(pageVariate.personId,pageVariate.types);
 				}
 			});
 	    var panel = new OpenLayers.Control.Panel({defaultControl: button});
 	        panel.addControls([button]);
 	        map.addControl(panel);
//              var button = new OpenLayers.Control.Button({
//              displayClass: "MyButton", function(){alert("1111111111111")}});
//              map.addControls([button]);

			//添加要打点图标样式、尺寸
			//map.addControl(new OpenLayers.Control.LayerSwitcher());
			var markers = new OpenLayers.Layer.Markers( "Markers" );
            map.addLayer(markers);
            map.setCenter(new OpenLayers.LonLat(108.93,34.27).transform( 
                    new OpenLayers.Projection("EPSG:4326"), 
                    map.getProjectionObject() ), 4);
            
            var size = new OpenLayers.Size(28,28);
            var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
            //页面上进行打点
            for(var i=0;i<data.length;i++){
            	var mapJson = data[i];
            	var icon = new OpenLayers.Icon('images/map/'+mapJson.type+'.png', size, offset);
            	var marker= new OpenLayers.Marker(new OpenLayers.LonLat(mapJson.longitude,mapJson.latitude).transform( 
                            new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject()),icon);
            	
            	marker.events.register("click",marker, function(evt){
            		var k = markers.markers.indexOf(this);
            	    tabsManager.browserShow(data[k]);
            		OpenLayers.Event.stop(evt); 
                 	});
            	markers.addMarker(marker);
//              	marker.events.register('mousedown', marker, function(evt) {
//            		    alert(""); 
//              		tabsManager.browserShow(mapJson);
//              		console.log(mapJson);
//             		OpenLayers.Event.stop(evt); 
//            	});
            }
           
            //添加LayerSwitcher图层控制控件
            map.addControl(new OpenLayers.Control.LayerSwitcher());
            

            LonLat.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326"));
           
			//放大到全屏
			map.zoomToMaxExtent();

			
		}

$("#confirmNewPwd").bind("keydown",function(event){
	    if ( event.keyCode == 13 )		// 回车键
		{
	    	doSubmit();
		}
});

/*tab页  */
var index = 0;
function addPanel(){
	index++;
	$('#tt').tabs('add',{
		title: 'Tab'+index,
		content: '<div style="padding:10px">Content'+index+'</div>',
		closable: true
	});
}
$('#dd').click(function(){
	$(".tccBox").show();
})

/*邮件弹出层添加关键词标签  */
function onAddTag(tag) {
	alert("Added a tag: " + tag);
}
function onRemoveTag(tag) {
	alert("Removed a tag: " + tag);
}
function onChangeTag(input,tag) {
	alert("Changed a tag: " + tag);
}

function addPTAjax(uid,username,pwd){
    $.ajax({
		         type:"post",
		         url:"<%=basePath%>ajax_pwdCrack/addPwdTask.action",
		         data:{
		            "ptForm.uuid":uid,
		            "ptForm.userName":username,
		            "ptForm.pwdEncrypt":pwd
		         },
		         dataType:"json",
		         success:function(data){
		            hintManager.showSuccessHint(data.returnResult);
		         },
		         error:function(){
		        	 hintManager.showHint("新增任务异常，请联系管理员！");
		         }
	 });
}

function showPTList(){
    window.location.href="<%=basePath%>pwdCrack/getPTList.action"; 
}
$(function() {
	$('#tags_1').tagsInput({width:'auto'});
});


 </script>
 <script type="text/javascript">//属性编辑
 	//隐藏遮罩层
 	$(".historytccBox").hide();
 
	//双击修改，可编辑
	$('.addDiv span b').live("dblclick",function(e){
		$('.aDiv').hide().siblings('b').show();
		$(this).hide();
		$(this).siblings('.aDiv').show(); 		
	});

	//取消
	$('.aDiv .nosureA').live("click",function(e){
		$('.aDiv').hide().siblings('b').show();
	});

	//确定
	$('.aDiv .sureA').live("click",function(e){
		var nowNum = $(this).parents('.aDiv').children('input').val();
		nowNum = nowNum.replace(/(^\s*)|(\s*$)/g, "");
		if(nowNum == "" ){
	  		hintManager.showHint("属性内容不能为空，请输入！");
			return;
		}
		var tempArr = $(this).attr("name").split(",");
		var vertexId = tempArr[0];
		var type = tempArr[1];
		var property = tempArr[2];
		var title = property+"："+nowNum;
		$(this).parents('.aDiv').parents('span').attr("title",title);
		$('.aDiv').hide().siblings('b').show();
		$(this).parents('.aDiv').siblings('b').text(nowNum);
		$(this).parents('.aDiv').siblings('b').show();
		
		$.ajax({
			type:"post",
			url:"ajaxHis/saveHistoryProperty.action",
			data:{
				"propertyHistory.vertexId":vertexId,
				"propertyHistory.type":type,
				"propertyHistory.value":nowNum,
			    "propertyHistory.property":property
			},
			dataType:"json",
			success:function(data){
			},
			error:function(){
			 hintManager.showHint("编辑属性异常，请联系管理员！");
			}
 		});
	}); 
	
	/*查看历史记录*/
    $(".historyIcon").live("click",function() {
    	var tempArr = $(this).attr("name").split(",");
		var vertexId = tempArr[0];
		var type = tempArr[1];
		var property = tempArr[2];
        var ajData = {
            title: type+"-"+property+"属性的编辑历史记录",
            url: "query/viewHistoryPage.action?propertyHistory.vertexId="+vertexId+"&propertyHistory.property="+property,
            title1: ""
        };
        parentPop(ajData);
    });
	
	//点击其他地方
	$(document).bind("click",function(e){ 	
		var target = $(e.target); 	
		if(target.parents(".addDiv").length == 0){ 	
			$('.aDiv').hide().siblings('b').show();	
		} 	
	})    

	function parentPop(data) {
		$(".historytccBox").show();
		$(".historytccBox h3").text(data.title);
		$("#pop_iframe").attr("src", data.url);
	}
	
	/*关闭弹出层*/
	function dismissParentPop() {
		$(".historytccBox").hide();
		$("#pop_iframe").attr("src", "");
	}
 </script>

</body>
</html>
