# WARNING: Using a password on the command line interface can be insecure.
# Source on localhost: ... connected.
# Exporting metadata from story
DROP DATABASE IF EXISTS `story`;
CREATE DATABASE `story`;
USE `story`;
# TABLE: story.covert_channel
CREATE TABLE `covert_channel` (
  `idcovert_channel` int(11) NOT NULL,
  `sip` bigint(12) DEFAULT NULL,
  `dip` bigint(12) DEFAULT NULL,
  `flow` int(11) DEFAULT NULL,
  `start_t` datetime DEFAULT NULL,
  `type` varchar(45) DEFAULT NULL,
  `account` varchar(45) DEFAULT NULL,
  `duration` int(11) DEFAULT NULL,
  `imei` varchar(45) DEFAULT NULL,
  `slocation` varchar(45) DEFAULT NULL,
  `dlocation` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`idcovert_channel`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
# TABLE: story.location
CREATE TABLE `location` (
  `idlocation` int(11) NOT NULL,
  `phone` varchar(45) DEFAULT NULL,
  `imei` varchar(45) DEFAULT NULL,
  `time` datetime DEFAULT NULL,
  `latitude` double DEFAULT NULL,
  `longitude` double DEFAULT NULL,
  `dst_lat` double DEFAULT NULL,
  `dst_lng` double DEFAULT NULL,
  `dst_name` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`idlocation`),
  UNIQUE KEY `idlocation_UNIQUE` (`idlocation`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
# FUNCTION: story.rand_chars
DELIMITER ||
CREATE DEFINER=`root`@`localhost` FUNCTION `rand_chars`(n INT) RETURNS varchar(255) CHARSET latin1
BEGIN
    DECLARE chars_str varchar(100) DEFAULT 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    DECLARE return_str varchar(255) DEFAULT '';
    DECLARE i INT DEFAULT 0;
    WHILE i < n DO
        SET return_str = concat(return_str,substring(chars_str , FLOOR(1 + RAND()*26 ),1));
        SET i = i +1;
    END WHILE;
    RETURN return_str;
END;
||
DELIMITER ;
# FUNCTION: story.rand_num
DELIMITER ||
CREATE DEFINER=`root`@`localhost` FUNCTION `rand_num`(n INT) RETURNS varchar(255) CHARSET latin1
BEGIN
    DECLARE chars_str varchar(100) DEFAULT '0123456789';
    DECLARE return_str varchar(255) DEFAULT '';
    DECLARE i INT DEFAULT 0;
    WHILE i < n DO
        SET return_str = concat(return_str,substring(chars_str , FLOOR(1 + RAND()*9 ),1));
        SET i = i +1;
    END WHILE;
    RETURN return_str;
END;
||
DELIMITER ;
# FUNCTION: story.rand_string
DELIMITER ||
CREATE DEFINER=`root`@`localhost` FUNCTION `rand_string`(n INT) RETURNS varchar(255) CHARSET latin1
BEGIN
    DECLARE chars_str varchar(100) DEFAULT 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    DECLARE return_str varchar(255) DEFAULT '';
    DECLARE i INT DEFAULT 0;
    WHILE i < n DO
        SET return_str = concat(return_str,substring(chars_str , FLOOR(1 + RAND()*62 ),1));
        SET i = i +1;
    END WHILE;
    RETURN return_str;
END;
||
DELIMITER ;
# PROCEDURE: story.generate_location_test_data
DELIMITER ||
CREATE DEFINER=`root`@`localhost` PROCEDURE `generate_location_test_data`(loop_times INT)
BEGIN
    DECLARE var INT DEFAULT 0; 
    DECLARE nearby INT DEFAULT 0; 
    WHILE var<loop_times DO    
    SET var=var+1;
    INSERT INTO story.location (idlocation,phone,imei,time,latitude,longitude,dst_lat,dst_lng,dst_name)   
    VALUES (var,CONCAT('13',rand_num(9)),rand_num(15),DATE_SUB(now(),INTERVAL FLOOR(1+RAND()*10000000) SECOND),(22+RAND() * (53.5-22)),(73.6+RAND() * (135-73.6)),(22+RAND() * (53.5-22)),(73.6+RAND() * (135-73.6)),rand_chars(4));
    END WHILE; 
    
    /* HMJD target*/
    SET var=var+1;
	INSERT INTO story.location (idlocation,phone,imei,time,latitude,longitude,dst_lat,dst_lng,dst_name)   
    VALUES (var,'13301742588','011472001975695',DATE_SUB(now(),INTERVAL 1000000 SECOND),36.072348,120.389416,35.743696,119.993538,'HMJD');
    
    /* HMJD nearby*/
    WHILE nearby < 20 DO   
    SET nearby=nearby+1;
	INSERT INTO story.location (idlocation,phone,imei,time,latitude,longitude,dst_lat,dst_lng,dst_name)   
    VALUES (var+nearby,'13301742588','011472001975695',DATE_SUB(now(),INTERVAL FLOOR(1+RAND()*10000000) SECOND),(35.733353+RAND() * (35.75304-35.733353)),(119.984542+RAND() * (120.002077-119.984542)),(22+RAND() * (53.5-22)),(73.6+RAND() * (135-73.6)),'HMJD');
	END WHILE;

END;
||
DELIMITER ;
# PROCEDURE: story.generate_test_data
DELIMITER ||
CREATE DEFINER=`root`@`localhost` PROCEDURE `generate_test_data`(loop_times INT)
BEGIN
    DECLARE var INT DEFAULT 0;  
    
    /* VPN */
    WHILE var<loop_times DO    
    SET var=var+1;
    INSERT INTO story.covert_channel (idcovert_channel,sip,dip,flow,start_t,duration,type,account,imei,slocation,dlocation)   
    VALUES (var,FLOOR( (RAND() * POW(2,32))),FLOOR( (RAND() * POW(2,32))),FLOOR( 10+(RAND() * 10000)),DATE_SUB(now(),INTERVAL FLOOR(1+RAND()*10000000) SECOND),FLOOR((RAND()*1000)),'VPN',rand_string(16),rand_num(15),rand_chars(2),rand_chars(2));
    END WHILE; 
    
    /* SKYPE */
    WHILE var<loop_times*2 DO    
    SET var=var+1;
    INSERT INTO story.covert_channel (idcovert_channel,sip,dip,flow,start_t,duration,type,account,imei,slocation,dlocation)   
    VALUES (var,FLOOR( (RAND() * POW(2,32))),FLOOR( (RAND() * POW(2,32))),FLOOR( 10+(RAND() * 10000)),DATE_SUB(now(),INTERVAL FLOOR(1+RAND()*10000000) SECOND),FLOOR((RAND()*1000)),'SKYPE',rand_string(16),rand_num(15),rand_chars(2),rand_chars(2));
    END WHILE; 
  
    /* GMAIL */
    WHILE var<loop_times*3 DO    
    SET var=var+1;
    INSERT INTO story.covert_channel (idcovert_channel,sip,dip,flow,start_t,duration,type,account,imei,slocation,dlocation)   
    VALUES (var,FLOOR( (RAND() * POW(2,32))),FLOOR( (RAND() * POW(2,32))),FLOOR( 10+(RAND() * 10000)),DATE_SUB(now(),INTERVAL FLOOR(1+RAND()*10000000) SECOND),FLOOR((RAND()*1000)),'GMAIL',rand_string(16),rand_num(15),rand_chars(2),rand_chars(2));
    END WHILE; 
    
    /* GMAIL isei=011472001975695*/
    WHILE var<loop_times*3+10 DO    
    SET var=var+1;
    INSERT INTO story.covert_channel (idcovert_channel,sip,dip,flow,start_t,duration,type,account,imei,slocation,dlocation)   
    VALUES (var,FLOOR( (RAND() * POW(2,32))),FLOOR( (RAND() * POW(2,32))),FLOOR( 10000000+(RAND() * 100000000)),DATE_SUB(now(),INTERVAL FLOOR(1+RAND()*10000000) SECOND),FLOOR((RAND()*1000)),'GMAIL',rand_string(16),'011472001975695',rand_chars(2),'TW');
    END WHILE; 
    
	/* SKYPE isei=011472001975695*/
    WHILE var<loop_times*3+20 DO    
    SET var=var+1;
    INSERT INTO story.covert_channel (idcovert_channel,sip,dip,flow,start_t,duration,type,account,imei,slocation,dlocation)   
    VALUES (var,FLOOR( (RAND() * POW(2,32))),FLOOR( (RAND() * POW(2,32))),FLOOR( 10000000+(RAND() * 100000000)),DATE_SUB(now(),INTERVAL FLOOR(1+RAND()*10000000) SECOND),FLOOR((RAND()*1000)),'SKYPE',rand_string(16),'011472001975695',rand_chars(2),'TW');
    END WHILE; 
END;
||
DELIMITER ;
#...done.
